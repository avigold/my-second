{% extends "base.html" %}
{% block title %}mysecond – Import PGN{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-1">Import Player Games from PGN</h1>
<p class="text-gray-500 text-sm mb-6">
  Use this when a player's Lichess account is inactive or you want to
  import OTB games from another source (chessgames.com, FIDE, TWIC, etc.).
  Games are indexed into the local cache under the username you provide;
  use that same username with
  <code class="text-amber-400">Find Novelties → Player</code> to filter
  the theory walk to their real repertoire.
</p>

<form id="import-form" class="bg-gray-900 border border-gray-800 rounded-lg p-6 space-y-5"
      enctype="multipart/form-data">

  <div>
    <label class="form-label" for="pgn_file">PGN File <span class="text-amber-400">*</span></label>
    <input id="pgn_file" name="pgn_file" type="file" accept=".pgn"
           required class="form-input" style="padding:0.3rem 0.5rem;">
    <p class="text-gray-600 text-xs mt-1">
      Accepts any standard PGN. Download from chessgames.com, lichess.org/games/export, FIDE, etc.
    </p>
  </div>

  <div class="grid grid-cols-2 gap-4">
    <div>
      <label class="form-label" for="username">Cache Username <span class="text-amber-400">*</span></label>
      <input id="username" name="username" type="text" required
             placeholder="e.g. GothamChess"
             class="form-input">
      <p class="text-gray-600 text-xs mt-1">Used as the cache key — match it to the search's Player field.</p>
    </div>
    <div>
      <label class="form-label" for="color">Colour <span class="text-amber-400">*</span></label>
      <select id="color" name="color" class="form-input">
        <option value="white">White</option>
        <option value="black">Black</option>
      </select>
    </div>
  </div>

  <details class="text-sm">
    <summary class="text-gray-400 cursor-pointer text-xs">Advanced</summary>
    <div class="mt-3">
      <label class="form-label" for="max_plies">Max Plies per Game (default 30)</label>
      <input id="max_plies" name="max_plies" type="number" min="5" max="60" placeholder="30"
             class="form-input" style="max-width:120px;">
    </div>
  </details>

  <div>
    <button type="submit" id="submit-btn" class="btn-primary">Import Games</button>
  </div>
</form>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('import-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const btn = document.getElementById('submit-btn');
  btn.disabled = true;
  btn.textContent = 'Uploading…';

  const formData = new FormData(e.target);
  try {
    const res = await fetch('/api/import-pgn', { method: 'POST', body: formData });
    const data = await res.json();
    if (data.job_id) {
      window.location = `/jobs/${data.job_id}`;
    } else {
      alert(data.error || 'Import failed');
      btn.disabled = false;
      btn.textContent = 'Import Games';
    }
  } catch (err) {
    alert('Request failed: ' + err.message);
    btn.disabled = false;
    btn.textContent = 'Import Games';
  }
});
</script>
{% endblock %}
